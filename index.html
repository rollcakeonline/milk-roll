<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>ç”Ÿä¹³æ²è¨‚è³¼ç¶²</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">

<style>
  body{
    font-family:'Poppins',sans-serif;
    background:linear-gradient(135deg,#FFF0F5,#FFE4E1);
    overflow-x:hidden;
  }
  .card{
    border-radius:20px;
    background:#fff3f8;
    box-shadow:0 4px 12px rgba(0,0,0,.1);
    transition:.3s;
    position:relative;
  }
  .card:hover{transform:translateY(-5px)}
  .btn-sweet{
    background:#FFB6C1;
    color:#fff;
    border-radius:25px;
  }
  .btn-sweet:active{transform:scale(.97)}
  .heart{
    position:absolute;
    top:10px;right:10px;
    font-size:24px;
    animation:float 1.5s infinite;
  }
  @keyframes float{
    0%{transform:translateY(0)}
    50%{transform:translateY(-8px)}
    100%{transform:translateY(0)}
  }

  /* navbar cart icon */
  .cart-btn{
    position:relative;
    border:none;
    background:transparent;
    font-size:22px;
    padding:6px 10px;
  }
  .badge-cart{
    position:absolute;
    top:0px;
    right:0px;
    background:#ff4d88;
    color:#fff;
    border-radius:999px;
    font-size:12px;
    min-width:20px;
    height:20px;
    display:flex;
    align-items:center;
    justify-content:center;
    padding:0 6px;
    transform:translate(30%,-30%);
  }
</style>
</head>

<body>

<nav class="navbar navbar-expand-lg bg-white shadow-sm mb-4">
  <div class="container">
    <a class="navbar-brand fw-bold" href="#">Fresh Roll</a>

    <div class="ms-auto d-flex align-items-center gap-2">
      <a class="nav-link" href="#products">å•†å“</a>
      <button class="cart-btn" type="button" data-bs-toggle="modal" data-bs-target="#cartModal" aria-label="è³¼ç‰©è»Š">
        ğŸ›’
        <span class="badge-cart" id="cartCount">0</span>
      </button>
    </div>
  </div>
</nav>

<div class="container pb-5">
  <h1 class="text-center mb-4">ğŸ° ç”Ÿä¹³æ²è¨‚è³¼ç¶²ç«™</h1>

  <!-- å•†å“å€ -->
  <div id="products" class="row g-4"></div>
</div>

<!-- âœ… è³¼ç‰©è»Š Modal -->
<div class="modal fade" id="cartModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content" style="border-radius:18px;">
      <div class="modal-header">
        <h5 class="modal-title">ğŸ›’ æˆ‘çš„è³¼ç‰©è»Š</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="é—œé–‰"></button>
      </div>

      <div class="modal-body">
        <div id="cartList" class="mb-3">é‚„æ²’æœ‰å•†å“å–”ï½</div>

        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0">ç¸½åƒ¹ï¼šNT$ <span id="cartTotal">0</span></h5>
          <button class="btn btn-outline-secondary btn-sm" id="clearCartBtn">æ¸…ç©ºè³¼ç‰©è»Š</button>
        </div>

        <hr class="my-3">

        <h6 class="fw-bold mb-2">è¨‚è³¼äººè³‡è¨Š</h6>
        <input type="text" class="form-control mb-2" id="customerName" placeholder="å§“å" required>
        <input type="tel" class="form-control mb-2" id="customerPhone" placeholder="é›»è©±" required>
        <input type="email" class="form-control mb-2" id="customerEmail" placeholder="Emailï¼ˆæ”¶ç¢ºèªä¿¡ï¼‰" required>

        <div class="row g-2">
          <div class="col-md-6">
            <select id="pickupMethod" class="form-select">
              <option value="é–€å¸‚å–è²¨">é–€å¸‚å–è²¨</option>
              <option value="å®…é…">å®…é…</option>
            </select>
          </div>
          <div class="col-md-6">
            <input type="date" id="pickupDate" class="form-control">
          </div>
        </div>

        <form id="paypalForm" class="mt-3" action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_blank">
          <input type="hidden" name="cmd" value="_cart">
          <input type="hidden" name="upload" value="1">
          <input type="hidden" name="currency_code" value="TWD">
          <input type="hidden" name="business" value="w0930170153@gmail.com">
          <button type="submit" class="btn btn-sweet w-100">çµå¸³ï¼ˆPayPalï¼‰</button>
        </form>

        <small class="text-muted d-block mt-2">
          æé†’ï¼šæŒ‰ä¸‹çµå¸³æœƒè·³å‡º PayPal è¦–çª—ï¼ŒåŒæ™‚å¯„å‡ºè¨‚å–® Emailã€‚
        </small>
      </div>
    </div>
  </div>
</div>

<!-- EmailJS -->
<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>

<!-- Bootstrap JSï¼ˆModal å¿…è¦ï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // âœ… EmailJS åˆå§‹åŒ–
  emailjs.init("lTjQlr749IV9zSp0c");

  // âœ… ä½ çš„å•†å“ï¼ˆå…­å€‹ï¼‰
  const products = [
    {name:"åŸå‘³ç”Ÿä¹³æ²", price:330, icon:"ğŸ®", img:"images/roll1.jpg"},
    {name:"å·§å…‹åŠ›ç”Ÿä¹³æ²", price:330, icon:"ğŸ«", img:"images/roll2.jpg"},
    {name:"æŠ¹èŒ¶ç”Ÿä¹³æ²", price:330, icon:"ğŸµ", img:"images/roll3.jpg"},
    {name:"ææ‹‰ç±³è˜‡ç”Ÿä¹³æ²", price:499, icon:"â˜•", img:"images/roll4.jpg"},
    {name:"èŠ‹æ³¥ç”Ÿä¹³æ²", price:499, icon:"ğŸ ", img:"images/roll5.jpg"},
    {name:"è‰è“ç”Ÿä¹³æ²", price:499, icon:"ğŸ“", img:"images/roll6.jpg"},
  ];

  // âœ… è³¼ç‰©è»Šè³‡æ–™
  let cart = []; // {name, price, qty}

  // âœ… æ¸²æŸ“å•†å“
  const productsEl = document.getElementById("products");
  productsEl.innerHTML = products.map(p => `
    <div class="col-md-4">
      <div class="card p-3 text-center">
        <div class="heart">${p.icon}</div>
        <img src="${p.img}" class="img-fluid rounded" alt="${p.name}">
        <h5 class="mt-2">${p.name}</h5>
        <p class="mb-2">NT$ ${p.price}</p>
        <button class="btn btn-sweet addBtn" data-name="${p.name}" data-price="${p.price}">åŠ å…¥è³¼ç‰©è»Š</button>
      </div>
    </div>
  `).join("");

  // âœ… åŠ å…¥è³¼ç‰©è»Š
  document.querySelectorAll(".addBtn").forEach(btn => {
    btn.addEventListener("click", () => {
      const name = btn.dataset.name;
      const price = parseInt(btn.dataset.price, 10);
      const found = cart.find(i => i.name === name);
      if (found) found.qty += 1;
      else cart.push({name, price, qty: 1});
      updateCartUI();
    });
  });

  // âœ… æ›´æ–°è³¼ç‰©è»Š UI + PayPal æ¬„ä½
  function updateCartUI(){
    const cartList = document.getElementById("cartList");
    const cartTotal = document.getElementById("cartTotal");
    const cartCount = document.getElementById("cartCount");
    const paypalForm = document.getElementById("paypalForm");

    // å¾½ç« æ•¸é‡ï¼ˆå…¨éƒ¨å“é …æ•¸é‡åŠ ç¸½ï¼‰
    const count = cart.reduce((s,i)=>s+i.qty,0);
    cartCount.textContent = count;

    // æ¸…ç©ºèˆŠ PayPal æ¬„ä½
    paypalForm.querySelectorAll('input[name^="item_name_"],input[name^="amount_"],input[name^="quantity_"]').forEach(el=>el.remove());

    // é¡¯ç¤ºè³¼ç‰©è»Šå…§å®¹
    cartList.innerHTML = "";
    let total = 0;

    if(cart.length === 0){
      cartList.innerHTML = "é‚„æ²’æœ‰å•†å“å–”ï½";
    }else{
      cart.forEach((item, idx) => {
        total += item.price * item.qty;

        const row = document.createElement("div");
        row.className = "d-flex justify-content-between align-items-center border rounded p-2 mb-2 bg-white";
        row.innerHTML = `
          <div>
            <div class="fw-bold">${item.name}</div>
            <small class="text-muted">å–®åƒ¹ NT$ ${item.price}ï½œæ•¸é‡ ${item.qty}</small>
          </div>
          <div class="d-flex align-items-center gap-2">
            <div class="fw-bold">NT$ ${item.price * item.qty}</div>
            <button class="btn btn-sm btn-outline-danger" data-del="${item.name}">åˆªé™¤</button>
          </div>
        `;
        cartList.appendChild(row);

        // PayPal æ¬„ä½
        const inputName = document.createElement("input");
        inputName.type="hidden";
        inputName.name=`item_name_${idx+1}`;
        inputName.value=item.name;
        paypalForm.appendChild(inputName);

        const inputAmount = document.createElement("input");
        inputAmount.type="hidden";
        inputAmount.name=`amount_${idx+1}`;
        inputAmount.value=item.price;
        paypalForm.appendChild(inputAmount);

        const inputQty = document.createElement("input");
        inputQty.type="hidden";
        inputQty.name=`quantity_${idx+1}`;
        inputQty.value=item.qty;
        paypalForm.appendChild(inputQty);
      });
    }

    cartTotal.textContent = total;

    // ç¶åˆªé™¤
    cartList.querySelectorAll("button[data-del]").forEach(b=>{
      b.addEventListener("click", ()=>{
        const n = b.dataset.del;
        cart = cart.filter(x => x.name !== n);
        updateCartUI();
      });
    });
  }

  // âœ… æ¸…ç©ºè³¼ç‰©è»Š
  document.getElementById("clearCartBtn").addEventListener("click", ()=>{
    cart = [];
    updateCartUI();
  });

  // âœ… çµå¸³æ™‚ï¼šå¯„ä¿¡ï¼ˆå®¢äºº + ä½ ï¼‰
  document.getElementById("paypalForm").addEventListener("submit", (event)=>{
    const name = document.getElementById("customerName").value.trim();
    const phone = document.getElementById("customerPhone").value.trim();
    const email = document.getElementById("customerEmail").value.trim();
    const pickup_method = document.getElementById("pickupMethod").value;
    const pickup_date = document.getElementById("pickupDate").value;
    const total = document.getElementById("cartTotal").innerText;

    if(cart.length === 0){
      alert("è³¼ç‰©è»Šé‚„æ²’æœ‰å•†å“å–”ï½");
      event.preventDefault();
      return;
    }
    if(!name || !phone || !email){
      alert("è«‹å¡«å¯«å§“åã€é›»è©±ã€Emailï¼ˆEmail ç”¨ä¾†å¯„ç¢ºèªä¿¡ï¼‰");
      event.preventDefault();
      return;
    }

    let product = "";
    cart.forEach(i=>{
      product += `${i.name} x ${i.qty}ï¼ˆå–®åƒ¹ NT$${i.price}ï¼‰\n`;
    });

    const data = { name, phone, email, product, total, pickup_method, pickup_date };

    // å¯„çµ¦å®¢äºº
    emailjs.send("service_mcvontk", "template_wdfonnc", data);

    // å¯„çµ¦ä½ ï¼ˆæ”¹æˆä½ çš„ã€Œè¨‚å–®å°ˆç”¨ Gmailã€ï¼‰
    emailjs.send("service_mcvontk", "template_wdfonnc", {
      ...data,
      email: "rollroom.tw@gmail.com"
    });
  });

  // åˆå§‹ç•«é¢
  updateCartUI();
</script>

</body>
</html>
